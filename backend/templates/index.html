<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8" />
        <title>Job Tracker Application</title>
    </head>
    <body>
        <h1>Job Tracker</h1>
        
        
        <!--Live jobs search UI-->
        <label for ="search-input"> Search live jobs</label>
        <input type="text" id="search-input" placeholder="e.g Data Analyst"/>
        <button id="search-btn">Search</button>

        <div id ="live-results"></div>

      <hr/>

      <h2>Saved Jobs</h2>
      <div id="saved-jobs"></div>


        <script>
  
window.onload = () => {
  const searchInput = document.getElementById("search-input");
  const liveResults = document.getElementById("live-results");
  const searchBtn   = document.getElementById("search-btn");

  async function loadLiveJobs() {
    const query = searchInput.value.trim() || "data scientist";
    try {
      const resp = await fetch(`/live-jobs?query=${encodeURIComponent(query)}&page=1`);
      if (!resp.ok) throw new Error("Status " + resp.status);
      const { jobs } = await resp.json();

      liveResults.innerHTML = "";
      if (jobs.length === 0) {
        liveResults.innerHTML = "<p>No results found.</p>";
        return;
      }

      // ── Here we loop and create a card for each job ────────────────
      jobs.forEach(job => {
        const card = document.createElement("div");
        card.className = "job-card";
        card.innerHTML = `
          <h3>${job.title}</h3>
          <p>${job.company} | ${job.location || "N/A"}</p>
          <p><small>Posted: ${job.posted}</small></p>
          <p>
            <a href="${job.apply_link}" target="_blank">Apply Here</a>
            <button class="save-btn">Save</button>
          </p>
        `;

        liveResults.appendChild(card);

        // ── Immediately after appending the card, grab and wire its Save button ──
        const saveBtn = card.querySelector(".save-btn");
        saveBtn.onclick = async () => {
          try {
            const r = await fetch("/save-job", {
              method: "POST",
              headers: {"Content-Type":"application/json"},
              body: JSON.stringify({
                title:      job.title,
                company:    job.company,
                location:   job.location,
                apply_link: job.apply_link
              })
            });
            if (!r.ok) throw new Error("Status " + r.status);
            alert("Job saved successfully!");
            loadSavedJobs();
          } catch (err) {
            alert("Failed to save: " + err);
          }
        };
      });

    } catch (err) {
      liveResults.innerText = "Error loading jobs: " + err;
    }
  }

  async function loadSavedJobs() {
    try{
      const resp = await fetch("/jobs");
      if(!resp.ok) throw new Error("Status"+ resp.status);

      const jobs = await resp.json();

      console.log("Saved jobs:",jobs);

      } catch (err) {
    // 2.1.5) If anything goes wrong, log the error
    console.error("Failed to load saved jobs:", err);
  }
}

    
    
  

  // Wire the search button
  searchBtn.onclick = loadLiveJobs;
};
</script>



