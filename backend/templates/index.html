<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8" />
        <title>Job Tracker Application</title>
    </head>
    <body>
        <h1>Job Tracker</h1>
        <button id="ping-btn">Ping Backend</button>
        <div id="ping-result"></div>
        
        <!--Live jobs search UI-->
        <label for ="search-input"> Search live jobs</label>
        <input type="text" id="search-input" placeholder="e.g Data Analyst"/>
        <button id="search-btn">Search</button>

        <div id ="live-results"></div>


        <script>
  window.onload = () => {
    const searchInput = document.getElementById("search-input");
    const liveResults = document.getElementById("live-results");
    const searchBtn   = document.getElementById("search-btn");

    // 1) Declare an async function
    async function loadLiveJobs() {
      // 2) Read and sanitize the query
      const query = searchInput.value.trim() || "data scientist";

      try {
        // 3) Make the HTTP request to /live-jobs
        const resp = await fetch(
          `/live-jobs?query=${encodeURIComponent(query)}&page=1`
        );
        // 4) Check for HTTP errors
        if (!resp.ok) throw new Error("Status " + resp.status);

        // 5) Parse the JSON body
        const payload = await resp.json();
        const jobs    = payload.jobs;  // extract the array

        // 6) Clear previous results
        liveResults.innerHTML = "";

        // 7) Handle “no results”
        if (jobs.length === 0) {
          liveResults.innerHTML = "<p>No results found.</p>";
          return;
        }

        // 8) For each job, create a card in the DOM
        jobs.forEach(job => {
          const card = document.createElement("div");
          card.className = "job-card";
          card.innerHTML = `
            <h3>${job.title}</h3>
            <p>${job.company} | ${job.location || "N/A"}</p>
            <p><small>Posted: ${job.posted}</small></p>
            <p><a href="${job.apply_link}" target="_blank">Apply Here</a></p>
          `;
          liveResults.appendChild(card);
        });

      } catch (err) {
        // 9) On any error, display a message
        liveResults.innerText = "Error loading jobs: " + err;
      }
    }

    // Wire the search button
    searchBtn.onclick = () => {
      loadLiveJobs();
    };
  };
</script>


    </body>
</html>


